<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - NeonWMS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="logo" style="margin-bottom: 40px;">NeonWMS</div>
            <ul class="sidebar-menu">
                <li><a href="demo.html" class="active">Panel Główny</a></li>
                <li><a href="products.html">Produkty</a></li>
                <li><a href="shipments.html">Wydania</a></li>
                <li><a href="clients.html">Klienci (CRM)</a></li>
                <li><a href="settings.html">Ustawienia</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <header style="background: transparent; padding: 0; margin-bottom: 30px; border: none; position: relative; display:flex; justify-content:space-between;">
                <h2>Panel Magazynowy</h2>
                <button id="btnReset" class="btn" style="font-size: 0.8rem; background: #333;">Resetuj Dane Demo</button>
            </header>

            <div class="stats-grid">
                <div class="stat-card purple">
                    <h3>Całkowita Ilość Sztuk</h3>
                    <div class="value" id="totalItems">0</div>
                </div>
                <div class="stat-card cyan">
                    <h3>Wartość Magazynu</h3>
                    <div class="value" id="totalValue">0 PLN</div>
                </div>
                <div class="stat-card">
                    <h3>Status Systemu</h3>
                    <div class="value" style="color: var(--accent-cyan)">ONLINE</div>
                </div>
            </div>

            <div class="grid-3" style="grid-template-columns: 1fr 2fr; margin-top: 20px;">
                
                <div class="card">
                    <h3 style="margin-bottom: 20px;">Dodaj Towar</h3>
                    <form id="wmsForm">
                        <label>Nazwa Produktu</label>
                        <input type="text" id="pName" class="form-control" required placeholder="np. Laptop Gamingowy">
                        
                        <label>Kategoria</label>
                        <select id="pCat" class="form-control">
                            <option value="Elektronika">Elektronika</option>
                            <option value="Akcesoria">Akcesoria</option>
                            <option value="Części">Części</option>
                        </select>

                        <div style="display: flex; gap: 10px;">
                            <div style="flex:1">
                                <label>Ilość</label>
                                <input type="number" id="pQty" class="form-control" value="1" min="1" required>
                            </div>
                            <div style="flex:1">
                                <label>Cena (PLN)</label>
                                <input type="number" id="pPrice" class="form-control" placeholder="0.00" step="0.01" required>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Zatwierdź Operację</button>
                    </form>
                </div>

                <div class="inventory-panel">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Stany Magazynowe</h3>
                        <span style="font-size: 0.8rem; color: var(--text-muted);">Dane na żywo z demo.js</span>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Produkt</th>
                                <th>Kategoria</th>
                                <th>Stan</th>
                                <th>Wartość</th>
                                <th>Status</th>
                                <th>Akcja</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

   <script type="module">
        import { Database } from './database.js';

        // Elementy DOM
        const tableBody = document.getElementById('inventoryTableBody');
        const totalItemsEl = document.getElementById('totalItems');
        const totalValueEl = document.getElementById('totalValue');
        const form = document.getElementById('wmsForm');
        const btnReset = document.getElementById('btnReset');

        // Funkcja renderująca tabelę
        function renderTable() {
            const data = Database.getAll('products');
            tableBody.innerHTML = '';

            if(data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 20px;">Brak produktów w magazynie</td></tr>';
                return;
            }

            data.forEach(item => {
                const tr = document.createElement('tr');
                // Logika statusu
                let statusClass = 'status-ok';
                let statusLabel = 'Dostępny';
                
                if (parseInt(item.quantity) < 3) {
                    statusClass = 'status-low';
                    statusLabel = 'Niski stan';
                }

                tr.innerHTML = `
                    <td style="font-weight:600;">${item.name}</td>
                    <td>${item.category}</td>
                    <td>${item.quantity} szt.</td>
                    <td>${parseFloat(item.price).toFixed(2)} zł</td>
                    <td><span class="status-badge ${statusClass}">${statusLabel}</span></td>
                    <td>
                        <button class="delete-btn" data-id="${item.id}" style="background:transparent; border:none; color:#ff4b91; cursor:pointer; font-weight:bold;">X</button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });

            // Podpięcie przycisków usuwania
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.getAttribute('data-id'));
                    if(confirm("Usunąć produkt?")) {
                        Database.delete('products', id);
                        refreshView();
                    }
                });
            });
        }

        // Funkcja aktualizująca statystyki na górze
        function updateStats() {
            const stats = Database.getStats();
            totalItemsEl.innerText = stats.totalItems;
            totalValueEl.innerText = stats.totalValue + ' PLN';
        }

        function refreshView() {
            renderTable();
            updateStats();
        }

        // Obsługa formularza dodawania
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newItem = {
                name: document.getElementById('pName').value,
                category: document.getElementById('pCat').value,
                quantity: parseInt(document.getElementById('pQty').value),
                price: parseFloat(document.getElementById('pPrice').value),
                status: 'ok' 
            };

            Database.add('products', newItem);
            
            form.reset();
            refreshView();
        });

        // Obsługa przycisku reset
        btnReset.addEventListener('click', () => {
            if(confirm("Czy na pewno zresetować całą bazę danych do ustawień fabrycznych?")) {
                Database.reset();
            }
        });

        // Start
        refreshView();
    </script>
</body>
</html>